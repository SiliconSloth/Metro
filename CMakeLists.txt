cmake_minimum_required (VERSION 3.10)
set (CMAKE_CXX_STANDARD 17)
set (CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)
include(CheckCXXSymbolExists)
project (Metro)

set(libgitInclude $ENV{LIBGIT_INCLUDE_DIR})
IF (DEFINED libgitInclude)
    include_directories("${libgitInclude}")
ENDIF()
set(libgitBuild $ENV{LIBGIT_BUILD_DIR})

set(libsshBuild $ENV{LIBSSH_BUILD_DIR})
set(opensslRoot $ENV{OPENSSL_ROOT_DIR})

include_directories("include")
add_executable(metro src/main.cpp)

IF (WIN32)
    IF (DEFINED libgitBuild)
        add_library(git2 STATIC IMPORTED)
        set_target_properties(git2 PROPERTIES IMPORTED_LOCATION "${libgitBuild}/git2.lib")
    ENDIF()
    IF (DEFINED libsshBuild)
        add_library(libssh2 STATIC IMPORTED)
        set_target_properties(libssh2 PROPERTIES IMPORTED_LOCATION "${libsshBuild}/libssh2.lib")
    ENDIF()
    IF (DEFINED opensslRoot)
        add_library(ssl STATIC IMPORTED)
        set_target_properties(ssl PROPERTIES IMPORTED_LOCATION "${opensslRoot}/libssl.lib")
        add_library(crypto STATIC IMPORTED)
        set_target_properties(crypto PROPERTIES IMPORTED_LOCATION "${opensslRoot}/libcrypto.lib")
    ENDIF()
    target_link_libraries(metro git2 libssh2 ssl crypto winhttp Rpcrt4 crypt32)
ENDIF()
IF (UNIX)
    IF (DEFINED libgitBuild)
        add_library(git2 STATIC IMPORTED)
        set_target_properties(git2 PROPERTIES IMPORTED_LOCATION "${libgitBuild}/libgit2.a")
    ENDIF()
    IF (DEFINED libsshBuild)
        add_library(libssh2 STATIC IMPORTED)
        set_target_properties(libssh2 PROPERTIES IMPORTED_LOCATION "${libsshBuild}/libssh2.a")
    ENDIF()

    IF (APPLE)
        target_link_libraries(metro git2 pthread crypto libssh2 iconv "-framework CoreFoundation" "-framework Security")
    ELSE()
        target_link_libraries(metro git2 pthread ssl crypto libssh2 stdc++fs)
    ENDIF()
ENDIF()
